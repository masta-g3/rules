# pv-004: Tree View Mode for Portfolio Visualization

**Epic**: pv
**Created**: 2026-01-24
**Depends On**: pv-001

## Overview

Collapsible tree view for portfolio-wide visualization with project→epic→feature hierarchy, inline dependency annotations, and search/filter capabilities.

## Solution

Hybrid tree view with collapsible outline and dependency annotations:

```
┌─ tree ──────────────────────────────────────────────────────────────────────┐
│                                                                             │
│  ▼ rules                          12/15 ████████████░░░░ 80%               │
│    ▼ pv                           1/4   ████░░░░░░░░░░░░ 25%               │
│        ✓ pv-001 Unified viewer                                             │
│        ○ pv-002 Edit mode                    ← pv-001                      │
│        ○ pv-003 Archive epics                ← pv-002                      │
│        ○ pv-004 Tree view                    ← pv-001                      │
│    ► auth                         8/8   ████████████████ 100%  (collapsed) │
│                                                                             │
├─────────────────────────────────────────────────────────────────────────────┤
│ [←/→]expand [j/k]move [/]search [z]oom [t]table view [q]uit                │
└─────────────────────────────────────────────────────────────────────────────┘
```

### Key Design Decisions

1. **Outline, not graph**: Dependencies shown as annotations (`← parent`) rather than crossing lines
2. **Three levels visible**: Project → Epic → Feature
3. **Collapse by default**: Projects expanded, epics collapsed initially
4. **Progress bars inline**: Each level shows completion status
5. **Search/filter**: `/` key activates search mode
6. **Lazy loading**: Epic children populated on first expansion

### Navigation

| Key | Action |
|-----|--------|
| `j/k` or `↓/↑` | Move cursor |
| `→` or `l` | Expand / drill into feature |
| `←` or `h` | Collapse / move to parent |
| `o` | Toggle expand/collapse |
| `O` | Expand all under cursor |
| `M` | Collapse all |
| `/` | Enter search mode |
| `n/N` | Next/prev search result |
| `z` | Zoom to subtree |
| `t` | Toggle to table view |
| `a` | Toggle show all |

## Summary

### Phase 1: Core Tree View
- [x] TreeNode and TreeState dataclasses
- [x] build_tree() with lazy epic loading
- [x] flatten_tree() for rendering
- [x] render_tree_node() with colors, progress bars, dependency annotations
- [x] view_tree() with scroll handling
- [x] Tree navigation (j/k/h/l/o/O/M)
- [x] `t` key toggle between tree and portfolio views

### Phase 2: Search & Filter
- [x] search_tree() recursive search
- [x] expand_path_to() for revealing matches
- [x] `/` search mode with incremental highlighting
- [x] `n/N` for next/prev match
- [x] `a` toggle for show all

### Phase 3: Zoom Mode
- [x] `z` key to zoom to cursor subtree
- [x] Footer shows [zoomed] indicator
- [x] `z` again to unzoom
